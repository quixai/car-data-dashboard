# Car data dashboard
Simple example how to present data in Quix Data catalogue using Plotly and Dash library in Python.

 
[![](doc/car-demo-dashboard.svg)](doc/car-demo-dashboard.svg "Architecture") 

First we need to get data into Python using Data catalogue API and Connect feature of portal. 

**Steps**:
1) Go to Visualize in portal and select data to visualize. 
2) Click Connect button
3) Select Python as language
4) Copy code to your dashboard project

## Code example
This is data catalogue request example generated by portal using **Connect** feature. Replace token with PAT token generated in portal. 
```python
url = "https://telemetry-query-<ORGANIZATION>-<WORKSPACE>.platform.quix.ai/parameters/data"
token = "YOUR_PAT_TOKEN"
head = {'Authorization': 'Bearer {}'.format(token), 'Accept': "application/csv"}
payload = {
    'from': 1612191093560000000,
    'to': 1612191171000000000,
    'numericParameters': [
        {
            'parameterName': 'Speed',
            'aggregationType': 'Mean'
        },
        {
            'parameterName': 'Brake',
            'aggregationType': 'Mean'
        }
    ],
    'stringParameters': [
        {
            'parameterName': 'HardBraking',
            'aggregationType': 'First'
        }
    ],
    'streamIds': [
        '1d9a8797-b222-42fc-917a-b26a2b332cb8',
        '1d9a8797-b222-42fc-917a-b26a2b332cb8-hard-braking'
    ],
    'groupByTime': {
        'timeBucketDuration': 100000000,
        'interpolationType': 'None'
    },
    'groupBy': []
}

response = requests.post(url, headers=head, json=payload)

df = pd.read_csv(io.StringIO(response.content.decode('utf-8')))
```
We do some handy transformations to help the visualization.

```python
# We convert boolean parameter to numeric to represent value in graph.
df["first(HardBraking)"] = df["first(HardBraking)"].apply(lambda x: 1 if x is True else 0)

# We convert nanoseconds epoch to datetime for better readability. 
df["Timestamp"] = df["Timestamp"].apply(lambda x: datetime.datetime.fromtimestamp(x / (1000 * 1000 * 1000)))
```

With data in data frame we initiate graph using Plotly.

```python
external_stylesheets = ['https://codepen.io/chriddyp/pen/bWLwgP.css']
app = dash.Dash(__name__, external_stylesheets=external_stylesheets)

# We add secondary y axe to accommodate second parameter.
fig = make_subplots(specs=[[{"secondary_y": True}]])

# Add series into plot for speed.
fig.add_trace(
    go.Scatter(x=df["Timestamp"].to_numpy(), y=df["Speed"].to_numpy(), name="Speed"),
    secondary_y=False,
)

# Add series into plot for engine RPM.
fig.add_trace(
    go.Scatter(x=df["Timestamp"].to_numpy(), y=df["EngineRPM"].to_numpy(), name="EngineRPM"),
    secondary_y=True,
)
```

Then we build page with HTML:
```python
external_stylesheets = ['https://codepen.io/chriddyp/pen/bWLwgP.css']
app = dash.Dash(__name__, external_stylesheets=external_stylesheets)

# We add secondary y axe to accommodate second parameter.
fig = make_subplots(specs=[[{"secondary_y": True}]])

# Add series into plot for speed.
fig.add_trace(
    go.Scatter(x=df["Timestamp"].to_numpy(), y=df["Speed"].to_numpy(), name="Speed"),
    secondary_y=False,
)

# Add series into plot for engine RPM.
fig.add_trace(
    go.Scatter(x=df["Timestamp"].to_numpy(), y=df["EngineRPM"].to_numpy(), name="EngineRPM"),
    secondary_y=True,
)
```


