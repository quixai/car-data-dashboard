# Car data dashboard
A simple example of how to present data in Quix Data catalogue using Plotly and Dash library in Python.

 
[![](doc/car-demo-dashboard.svg)](doc/car-demo-dashboard.svg "Architecture") 

## Installation
In your terminal, install several **dash** libraries.
```python
pip install dash
```

We also going to need *requests* library.
In your terminal, install several **dash** libraries.
```python
pip install requests
```

## Getting data from Quix
First, we need to get data into Python using Data catalogue API and Connect feature of the portal. 

**Steps**:
1) Go to Visualize in the portal and select data to visualize. 
2) Click Connect button
3) Select Python as a language
4) Copy code to your dashboard project

## Code example
This is data catalogue request example generated by portal using **Connect** feature. Replace token with PAT token generated in portal. 
```python
url = "https://telemetry-query-<ORGANIZATION>-<WORKSPACE>.platform.quix.ai/parameters/data"
token = "YOUR_PAT_TOKEN"
head = {'Authorization': 'Bearer {}'.format(token), 'Accept': "application/csv"}
payload = {
    'from': 1612191093560000000,
    'to': 1612191171000000000,
    'numericParameters': [
        {
            'parameterName': 'Speed',
            'aggregationType': 'Mean'
        },
        {
            'parameterName': 'Brake',
            'aggregationType': 'Mean'
        }
    ],
    'stringParameters': [
        {
            'parameterName': 'HardBraking',
            'aggregationType': 'First'
        }
    ],
    'streamIds': [
        '1d9a8797-b222-42fc-917a-b26a2b332cb8',
        '1d9a8797-b222-42fc-917a-b26a2b332cb8-hard-braking'
    ],
    'groupByTime': {
        'timeBucketDuration': 100000000,
        'interpolationType': 'None'
    },
    'groupBy': []
}

response = requests.post(url, headers=head, json=payload)

df = pd.read_csv(io.StringIO(response.content.decode('utf-8')))
```
We do some handy transformations to help the visualization.

```python
# We convert the boolean parameter to numeric to represent the value in the graph.
df["first(HardBraking)"] = df["first(HardBraking)"].apply(lambda x: 1 if x is True else 0)

# We convert nanoseconds epoch to datetime for better readability. 
df["Timestamp"] = df["Timestamp"].apply(lambda x: datetime.datetime.fromtimestamp(x / (1000 * 1000 * 1000)))
```

With data in the data frame, we initiate the graph using Plotly.

```python
external_stylesheets = ['https://codepen.io/chriddyp/pen/bWLwgP.css']
app = dash.Dash(__name__, external_stylesheets=external_stylesheets)

# We add secondary y axe to accommodate the second parameter.
fig = make_subplots(specs=[[{"secondary_y": True}]])

# Add series into plot for speed.
fig.add_trace(
    go.Scatter(x=df["Timestamp"].to_numpy(), y=df["Speed"].to_numpy(), name="Speed"),
    secondary_y=False,
)

# Add series into plot for engine RPM.
fig.add_trace(
    go.Scatter(x=df["Timestamp"].to_numpy(), y=df["EngineRPM"].to_numpy(), name="EngineRPM"),
    secondary_y=True,
)
```

Then we build page with HTML:
```python
app.layout = html.Div(children=[
    html.H1(children='Hello from Quix'),

    html.Div(children='''
        Example dashboard with Dash and Quix.
    '''),

    dcc.Graph(
        id='example-graph',
        figure=fig
    )
])
```

The last part is to run a server and set the port to **80** so you can host the dashboard in Quix.
```python
if __name__ == '__main__':
    # It is important to set port 80 to host this dashboard in Quix
    app.run_server(debug=True, host="0.0.0.0", port=80)
```

### Local test
Test this dashboard by running the python script and going to [http://localhost/](http://localhost/) in your browser.

## Quix deployment
You can deploy this dashboard in Quix. Please follow our documentation [here](https://documentation.platform.quix.ai/deploy/). Please pay attention to **Public access** paragraph.
